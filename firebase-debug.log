[debug] [2026-02-26T06:19:54.942Z] ----------------------------------------------------------------------
[debug] [2026-02-26T06:19:54.943Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\TrusxT\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules
[debug] [2026-02-26T06:19:54.944Z] CLI Version:   15.7.0
[debug] [2026-02-26T06:19:54.944Z] Platform:      win32
[debug] [2026-02-26T06:19:54.944Z] Node Version:  v20.18.1
[debug] [2026-02-26T06:19:54.944Z] Time:          Thu Feb 26 2026 09:19:54 GMT+0300 (GMT+03:00)
[debug] [2026-02-26T06:19:54.944Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-02-26T06:19:56.003Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-02-26T06:19:56.003Z] > authorizing via signed-in user (trusxtfurkan@gmail.com)
[debug] [2026-02-26T06:19:56.003Z] [iam] checking project realm-tycoon for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-02-26T06:19:56.004Z] Checked if tokens are valid: false, expires at: 1772054235358
[debug] [2026-02-26T06:19:56.004Z] Checked if tokens are valid: false, expires at: 1772054235358
[debug] [2026-02-26T06:19:56.004Z] > refreshing access token with scopes: []
[debug] [2026-02-26T06:19:56.006Z] >>> [apiv2][query] POST https://www.googleapis.com/oauth2/v3/token [none]
[debug] [2026-02-26T06:19:56.006Z] >>> [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2026-02-26T06:19:56.224Z] <<< [apiv2][status] POST https://www.googleapis.com/oauth2/v3/token 200
[debug] [2026-02-26T06:19:56.224Z] <<< [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2026-02-26T06:19:56.233Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/realm-tycoon:testIamPermissions [none]
[debug] [2026-02-26T06:19:56.234Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/realm-tycoon:testIamPermissions  x-goog-user-project=realm-tycoon
[debug] [2026-02-26T06:19:56.234Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/realm-tycoon:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-02-26T06:19:57.207Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/realm-tycoon:testIamPermissions 200
[debug] [2026-02-26T06:19:57.208Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/realm-tycoon:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'realm-tycoon'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-02-26T06:19:57.212Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:19:57.212Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:19:57.212Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/realm-tycoon/databases/(default) [none]
[debug] [2026-02-26T06:19:58.254Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/realm-tycoon/databases/(default) 200
[debug] [2026-02-26T06:19:58.254Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/realm-tycoon/databases/(default) {"name":"projects/realm-tycoon/databases/(default)","uid":"08e85af7-b40d-47a8-aed9-9430255ca323","createTime":"2026-02-23T12:12:50.825310Z","updateTime":"2026-02-23T12:12:50.825310Z","locationId":"nam5","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-02-26T05:19:58.834001Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"s","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"ILmun+HB9pIDMNWxmt7O75ID"}
[info] i  firestore: reading indexes from firestore.indexes.json... 
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-02-26T06:19:58.260Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:19:58.260Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:19:58.260Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/realm-tycoon:test [none]
[debug] [2026-02-26T06:19:58.260Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/realm-tycoon:test [omitted]
[debug] [2026-02-26T06:19:59.172Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/realm-tycoon:test 200
[debug] [2026-02-26T06:19:59.172Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/realm-tycoon:test {"issues":[{"sourcePosition":{"fileName":"firestore.rules","line":16,"column":14,"currentOffset":407,"endOffset":423},"description":"Unused function: isValidPlayerData.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":17,"column":14,"currentOffset":442,"endOffset":448},"description":"Invalid variable name: request.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":18,"column":14,"currentOffset":505,"endOffset":511},"description":"Invalid variable name: request.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":22,"column":14,"currentOffset":613,"endOffset":630},"description":"Unused function: isValidChatMessage.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":23,"column":14,"currentOffset":649,"endOffset":655},"description":"Invalid variable name: request.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":24,"column":14,"currentOffset":712,"endOffset":718},"description":"Invalid variable name: request.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":25,"column":15,"currentOffset":765,"endOffset":771},"description":"Invalid variable name: request.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":26,"column":16,"currentOffset":824,"endOffset":830},"description":"Invalid variable name: request.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":111,"column":26,"currentOffset":3988,"endOffset":3997},"description":"Invalid function name: startsWith.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":118,"column":26,"currentOffset":4375,"endOffset":4384},"description":"Invalid function name: startsWith.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":126,"column":26,"currentOffset":4692,"endOffset":4701},"description":"Invalid function name: startsWith.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":139,"column":14,"currentOffset":5089,"endOffset":5107},"description":"Unused function: isNonNegativeNumber.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":143,"column":14,"currentOffset":5180,"endOffset":5196},"description":"Unused function: isPositiveInteger.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":144,"column":42,"currentOffset":5246,"endOffset":5250},"description":"Invalid function name: floor.","severity":"WARNING"},{"sourcePosition":{"fileName":"firestore.rules","line":147,"column":14,"currentOffset":5290,"endOffset":5302},"description":"Unused function: isValidString.","severity":"WARNING"}]}
[warn] !  [W] 16:14 - Unused function: isValidPlayerData. 
[warn] !  [W] 17:14 - Invalid variable name: request. 
[warn] !  [W] 18:14 - Invalid variable name: request. 
[warn] !  [W] 22:14 - Unused function: isValidChatMessage. 
[warn] !  [W] 23:14 - Invalid variable name: request. 
[warn] !  [W] 24:14 - Invalid variable name: request. 
[warn] !  [W] 25:15 - Invalid variable name: request. 
[warn] !  [W] 26:16 - Invalid variable name: request. 
[warn] !  [W] 111:26 - Invalid function name: startsWith. 
[warn] !  [W] 118:26 - Invalid function name: startsWith. 
[warn] !  [W] 126:26 - Invalid function name: startsWith. 
[warn] !  [W] 139:14 - Unused function: isNonNegativeNumber. 
[warn] !  [W] 143:14 - Unused function: isPositiveInteger. 
[warn] !  [W] 144:42 - Invalid function name: floor. 
[warn] !  [W] 147:14 - Unused function: isValidString. 
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-02-26T06:19:59.176Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:19:59.177Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:19:59.177Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/realm-tycoon/releases pageSize=10&pageToken=
[debug] [2026-02-26T06:19:59.899Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/realm-tycoon/releases 200
[debug] [2026-02-26T06:19:59.899Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/realm-tycoon/releases {"releases":[{"name":"projects/realm-tycoon/releases/cloud.firestore","rulesetName":"projects/realm-tycoon/rulesets/475d4c80-56a1-4ac0-bd59-dad58c5b85f5","createTime":"2026-02-23T12:12:56.703208Z","updateTime":"2026-02-25T19:12:32.207592Z"}]}
[debug] [2026-02-26T06:19:59.899Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:19:59.899Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:19:59.899Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/realm-tycoon/rulesets/475d4c80-56a1-4ac0-bd59-dad58c5b85f5 [none]
[debug] [2026-02-26T06:20:00.618Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/realm-tycoon/rulesets/475d4c80-56a1-4ac0-bd59-dad58c5b85f5 200
[debug] [2026-02-26T06:20:00.618Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/realm-tycoon/rulesets/475d4c80-56a1-4ac0-bd59-dad58c5b85f5 [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-02-26T06:20:00.620Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:20:00.620Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:20:00.620Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/realm-tycoon/rulesets [none]
[debug] [2026-02-26T06:20:00.620Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/realm-tycoon/rulesets [omitted]
[debug] [2026-02-26T06:20:01.545Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/realm-tycoon/rulesets 200
[debug] [2026-02-26T06:20:01.545Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/realm-tycoon/rulesets {"name":"projects/realm-tycoon/rulesets/628edf58-ffe9-4274-8b4d-861da7adf1b4","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // Helper function to check if user is authenticated\n    function isAuthenticated() {\n      return request.auth != null;\n    }\n    \n    // Helper function to get user ID\n    function getUserId() {\n      return request.auth.uid;\n    }\n    \n    // Helper function to validate player data structure\n    function isValidPlayerData() {\n      return request.resource.data.keys().hasAll(['value']) &&\n             request.resource.data.value is map;\n    }\n    \n    // Helper function to validate chat message\n    function isValidChatMessage() {\n      return request.resource.data.keys().hasAll(['value']) &&\n             request.resource.data.value is list &&\n             (request.resource.data.value.size() == 0 || \n              (request.resource.data.value[-1].playerId == getUserId()));\n    }\n    \n    // Helper function to validate inbox entry\n    function isValidInboxEntry() {\n      return request.resource.data.keys().hasAll(['value']) &&\n             request.resource.data.value is list;\n    }\n    \n    // Helper function to validate market listing\n    function isValidMarketListing() {\n      return request.resource.data.keys().hasAll(['value']) &&\n             request.resource.data.value is list;\n    }\n    \n    // Helper function to validate leaderboard entry\n    function isValidLeaderboardData() {\n      return request.resource.data.keys().hasAll(['value']) &&\n             request.resource.data.value is map;\n    }\n    \n    // ========================================\n    // PLAYER DATA (Private - User Specific)\n    // ========================================\n    match /players/{playerId} {\n      // Allow read/write only to the owner\n      match /{document=**} {\n        allow read, write: if isAuthenticated() && playerId == getUserId();\n      }\n    }\n    \n    // ========================================\n    // SHARED DATA (Public with Restrictions)\n    // ========================================\n    match /shared_data/{docId} {\n\n      // --- CHAT MESSAGES (Subcollection Architecture) ---\n      match /chat-messages/{messageId} {\n        allow read: if true;\n\n        allow create: if isAuthenticated() &&\n                      request.resource.data.playerId == getUserId() &&\n                      request.resource.data.playerName is string &&\n                      request.resource.data.message is string &&\n                      request.resource.data.timestamp is number &&\n                      request.resource.data.channel is string;\n\n        // Prevent updates, allow delete for authenticated users (cleanup old messages)\n        allow update: if false;\n        allow delete: if isAuthenticated();\n      }\n\n      // Legacy chat-messages document (for backward compatibility during migration)\n      allow read: if docId == 'chat-messages';\n      allow write: if false; // Prevent writes to legacy document\n      \n      // --- PLAYER INBOX ---\n      allow read: if isAuthenticated() && \n                  docId == 'player-inbox';\n      \n      allow write: if isAuthenticated() && \n                   docId == 'player-inbox' &&\n                   isValidInboxEntry();\n      \n      // --- MARKET LISTINGS ---\n      // Anyone can read active listings\n      allow read: if true;\n      \n      // Market listings - authenticated users can write\n      // Note: .all() lambda is not supported in Firestore rules.\n      // Server-side validation via Cloud Functions is recommended\n      // for verifying individual listing ownership.\n      allow write: if isAuthenticated() &&\n                   docId == 'market-listings' &&\n                   isValidMarketListing();\n      \n      // --- LEADERBOARD ---\n      allow read: if true;\n      \n      allow write: if isAuthenticated() &&\n                   docId == 'leaderboard-data' &&\n                   isValidLeaderboardData();\n      \n      // --- TRADES ---\n      allow read: if isAuthenticated() && \n                  (docId.startsWith('trades_') && \n                   (resource.data.value.senderId == getUserId() || \n                    resource.data.value.targetId == getUserId() ||\n                    request.resource.data.value.senderId == getUserId() ||\n                    request.resource.data.value.targetId == getUserId()));\n      \n      allow write: if isAuthenticated() && \n                   docId.startsWith('trades_') &&\n                   (request.resource.data.value.senderId == getUserId() ||\n                    request.resource.data.value.targetId == getUserId());\n      \n      // --- PUBLIC PROFILES ---\n      allow read: if true;\n      \n      allow write: if isAuthenticated() && \n                   docId.startsWith('public-profile:') &&\n                   request.resource.data.value.playerId == getUserId();\n      \n      // --- DEFAULT: Deny all other shared documents ---\n      match /{otherDoc} {\n        allow read, write: if false;\n      }\n    }\n    \n    // ========================================\n    // DATA VALIDATION HELPERS\n    // ========================================\n    \n    function isNonNegativeNumber(val) {\n      return val is number && val >= 0;\n    }\n    \n    function isPositiveInteger(val) {\n      return val is number && val == val.floor() && val > 0;\n    }\n    \n    function isValidString(str, minLen, maxLen) {\n      return str is string && \n             str.size() >= minLen && \n             str.size() <= maxLen;\n    }\n  }\n}\n","name":"firestore.rules"}]},"createTime":"2026-02-26T06:20:02.089487Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-02-26T06:20:01.545Z] [rules] created ruleset projects/realm-tycoon/rulesets/628edf58-ffe9-4274-8b4d-861da7adf1b4
[debug] [2026-02-26T06:20:01.545Z] [rules] releasing cloud.firestore/(default) with ruleset projects/realm-tycoon/rulesets/628edf58-ffe9-4274-8b4d-861da7adf1b4
[debug] [2026-02-26T06:20:01.545Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:20:01.545Z] Checked if tokens are valid: true, expires at: 1772090395224
[debug] [2026-02-26T06:20:01.545Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/realm-tycoon/releases/cloud.firestore/(default) [none]
[debug] [2026-02-26T06:20:01.545Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/realm-tycoon/releases/cloud.firestore/(default) {"release":{"name":"projects/realm-tycoon/releases/cloud.firestore/(default)","rulesetName":"projects/realm-tycoon/rulesets/628edf58-ffe9-4274-8b4d-861da7adf1b4"}}
[debug] [2026-02-26T06:20:02.438Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/realm-tycoon/releases/cloud.firestore/(default) 200
